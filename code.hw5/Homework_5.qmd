---
title: "HW5"
format: 
  html:
    toc: true
    toc-location: left
    code-fold: true
    theme: yeti 
execute:
  message: false
  warning: false
---

Ethan Blacher

6/5/23

Homework 5

```{r Install_Packages}
# should haves (from last week)
library(tidyverse)
library(here)
library(janitor)
library(ggeffects)
library(performance)
library(naniar) # or equivalent
library(flextable) # or equivalent
library(car)
library(broom)
# would be nice to have
library(corrplot)
library(AICcmodavg)
library(GGally)
library(MuMIn)
```

6.  **Introduction**

    This analysis revolves around a study conducted at Harvard Forest in 2005, which explored the impact of prey availability on Sarracenia physiology. Sarracenia, also known as pitcher plants, are carnivorous wetland flora indigenous to North America (Farnsworth and Ellison). Pitcher plants are of interest to scientists because while plants typically contain an allometric relationship between nutrient and physiology (notably leaf size), referred to as the 'world-wide leaf economics spectrum' (Farnsworth and Ellison) this near-universal rule does not apply to carnivorous plants (such as Sarracenia). Due to the fact that carnivorous plants have low photosynthetic rates along with nitrogen and phosphorous use efficiency, their physiology has an outsized reliance on prey capture (Farnsworth and Ellison). Since prey capture is a leading indicator of carnivorous plant health (indicating crucial metrics like survival, growth, and reproduction) it is important to test how Sarracenia react to changes in the abunace of prey (Horner, Steele, Underwood, and Lingamfelter). Additionally, predicting individual biomass of Sarracenia based on morphological, physiological, or taxonomic characteristics is valuable because it allows a better understanding of their growth patterns, resource allocation, and ecological roles, potentailly shedding light on effective management practices and their contributions to ecosystem services. The study addressed the effects of prey availability on a litany of factors, using photosynthetic rate (Amass), chlorophyll fluorescence, growth, architecture, and foliar nutrient and chlorophyll content of ten pitcher plant (Sarracenia) species as indicators. A few interesting questions raised by this experiment is how prey density impacts Sarracenia growth and health, how does plant age alter their appetite and physiology, and ultimately when Sarracenia have unlimited resources whether their morphological and physiological allometric relationships resemble those of non-carnivorous plants (Lorne). This resulted in the hypothesis that increased prey availability would increase Amass, photosynthetic N- and P-use efficiencies, relative biomass allocation to photosynthetically efficient, non-predatory phyllodes rather than pitchers, overall plant biomass, and reduce stress-related chlorophyll fluorescence.

7.  **Methods**

    ```{r Read_Data}
    sarr <- read_csv(here::here("data.hw5","knb-lter-hfr.109.18 (3)", "hf109-01-sarracenia.csv")) %>% 
      #make the column names clear
      clean_names() %>% 
      #selecting the columns of interest
      select(totmass, species, feedlevel, sla, chlorophyll, amass, num_lvs, num_phylls)
    ```

    a\.

    120 Sarracenia plants ranging in size from small, medium, and large were used for the study were collected from the sampling site: Harvard Forest Greenhouse (meta data). To conduct the study, plants were fed once a week for 7 weeks straight (meta data). Two plants of each Sarracenia species were assigned to one of six feeding levels in a regression design ranging from 0 - 0.25g of finely ground wasps per feeding (for small species), 0 - 0.5g (for species of intermediate sizes), and 0 - 1.0g (for large species) (meta data). "Aboveground size" and "Amass" were measured prior to commencing treatments, meanwhile all other parameters were measured during the duration of the study (meta data).

    b\.

    In order to organize the data after reading in the necessary packages, it is important to see what data was measured. To do so, the full data set was read in using the read_csv and the here function, then to make the names of the objects within the data set more clear and too only include the objects of interest the clean_names and select functions were applied. The data set now appears readable with the data set reporting values observed for totmass, species, feedlevel, sla, chlorophyll, amass, num_lvs, num_phylls

    c\.

    ```{r Missing_Data_Viz}
    gg_miss_var(sarr) + labs(
      caption = "shows missing data" )
    ```

    **Caption: The gg_miss_var function highlights missing data within the "sarr" data set. The plot highlights missing data in the chlorophyll, amass, sla, num_phylls, and num_lvs columns, leaving only totmass, species, and feedlevel as columns without missing data.**

    **Discussion: Since there is a decent amount of missing data in a few parameters, it is important to identify where there is missing data to identify where bias and errors in the analysis might appear and skew the results.**

    d\.

    ```{r Drop_NA}
    sarr_subset <- sarr %>% 
      drop_na(sla, chlorophyll, amass, num_lvs, num_phylls)
    ```

    ```{r Pearson_Viz}
    #calculate pearson's r only for numerical values only
    sarr_cor <- sarr_subset %>% 
      select(feedlevel:num_phylls) %>% 
      cor(method = "pearson")

    #creating a correlation plot
    corrplot(sarr_cor,
             #change the shape of what's in the cells
             #point to the left=negative relationship, right=positive relationship
             method = "ellipse",
             #adds the correlation values in black over the elipses
             addCoef.col= "black") 
    ```

**Caption: To determine the relationship between the numerical variables in our data "sarr_subset", we calculcated pearson's r and highlighted the correlation using a correlation plot. The numerical variables we compared were feedlevel, sla, chlorophyll, amass, num_lvs, and num_phylls.**

**Discussion: After calculating pearson's r, it is apparent that none of the variables a strong correlation, since the highest value was only .32 between amass and sla. The correlations between sla and feedlevel, chlorophyll and sla, num_lvs and feedlevel, num_phylls and sla, and num_phylls and chlorophyll all had small, negative r values. On the other hand, chlorophyll and feedlevel, amass and feedlevel, num_phylls and feedlevel, and sla and num_lvs all have small, postive r values, with their being no correlation between amass and num_phylls (r=0).**

e\.

```{r pair-plot}
sarr_subset %>% 
  select(species:num_phylls) %>% 
  ggpairs() 
```

Caption: In order to visualize the relationship between the variables the ggpairs function was applied. The ggpairs function builds a scatterplot matrix that displays scatterplots of each pair of numeric values, while also displaying pearson's r on the right and the variable distribution on the diagonal.

Discussion: After visualizing the relationships between each pair of variables, the ggpair function reveals the different relationships between different varibales depending on the type of data each variable is. Box plots are used to represent relationships between species, categorical data, and the rest of the variables, continuous or discrete. The scatter plots and line graphs highlight relationships between continuous and discrete data.

f\.

```{r null-and-full-models}
null <- lm(totmass ~ 1, data= sarr_subset)
full <- lm(totmass ~ species + feedlevel + sla + chlorophyll + amass + num_lvs + num_phylls, data= sarr_subset)
```

To determine how species and physiological characteristics perditc biomass, we fit multiple linear models. The null model creates a regression model that assumes no realtionship between totmass and the predictor variables. On the other hand, the full model creates a regression model that assumes a relationship between totmass and the predictor variables in order to predict biomass.

g\.

```{r Viz_Check}
par(mfrow = c(2,2))
plot(full)
```

```{r Stat_Check}
check_normality(full)
check_heteroscedasticity(full)
```

We visually assesed normaility and homoskedascitity using diagnostic plots for the full model and found that the data is appears normal, but not homoskedastic because the data is not scattered entirely random. We also tested for normality using the Shaprio-Wilk test and found non-normality of residuals. We then retested for homoscedasticity using the Breusch-Pagan test and detected non-constant error variance meaning the data is heteroscedastic.

h\.

```{r}
null_log <- lm(log(totmass)~1, data = sarr_subset)
full_log <- lm(log(totmass)~ species + feedlevel + sla + chlorophyll + amass + num_lvs + num_phylls, data= sarr_subset)

plot(full_log)
check_normality(full_log)
check_heteroscedasticity(full_log)
```

After visually assesing normaility and homoscedascitity using diagnostic plots for the full model, we found that the data appeared to be non-normal and heteroscedasitic. In order to reduce the skewness of variable of interest, we applied a log transformation. Once we did this we were able to manipulate the residuals in a manner that reported normal distribution and homoscedastic variance.

i\.

```{r Model}
model_1 <- lm(log(totmass)~chlorophyll, data= sarr_subset)
model_2 <- lm(log(totmass)~amass, data = sarr_subset)
model_3 <- lm(log(totmass)~species, data = sarr_subset)
```

```{r Check}
plot(model_1)
check_normality(model_1)
check_heteroscedasticity(model_1)
plot(model_2)
check_normality(model_2)
check_heteroscedasticity(model_2)
plot(model_3)
check_normality(model_3)
check_heteroscedasticity(model_3)
```

The three models we chose to asses which predictor variables best model the response were chlorophyll, amass, and species.

```{r Variance_Inflation_Check}
car::vif(full)
```

We evaluated muticollinarity by calculating the generalized variance inflation factor and determined that this model didn't display any multicolinearity because no values were larger than 5.

k\.

```{r AIC-value}
AICc(full)
AICc(model_1)
AICc(model_2)
AICc(model_3)
AICc(null)

MuMIn::AICc(full, model_1, model_2, model_3, null)
MuMIn::model.sel(full, model_1, model_2, model_3, null)
```

6.  **Results**

<!-- -->

9.  **Citations**

    Farnsworth, Elizabeth J., and Aaron M. Ellison. "Prey Availability Directly Affects Physiology, Growth, Nutrient Allocation and Scaling Relationships among Leaf Traits in 10 Carnivorous Plant Species." *Journal of Ecology*, Vol. 0, No. 0, 2007, https://doi.org/10.1111/j.1365-2745.2007.01313.x

    Horner, John D., Steele, Cross J., Underwood, Christopher A., Lingamfelter, Daniel. "Age-Related Changes in Characteristics and Prey Capture of Seasonal Cohorts of Sarracenia alata Pitchers." *The American Midland Naturalist,* Vol. 167, No. 1, 2012,[https://doi.org/10.1674/0003-0031-167.1.13](#0)

    Wolfe, Lorne M. "Feeding Behavior of a Plant: Differential Prey Capture in Old and New Leaves of the Pitcher Plant (Sarracenia purpurea)." *The American Midland Naturalist,* Vol. 106, No. 2, 1981, https://www.jstor.org/stable/2425172?origin=crossref
